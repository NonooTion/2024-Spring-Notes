

# 计算机网络 Computer Networks 课程笔记

Recorded by NonoTion

# 计算机网络概述

## 1.1 因特网概述

### Internet

Internet的概念

Internet是由网络通信设备、通信线路及基于共同通信协议**TCP/IP**的多个计算机网络系统而构成的**全球性计算机网络**，是无特定网络讲解的网络互联的集合

Internet的前身->ARPANET实验网

演变历程：军用实验->学术应用->商业应用过渡->实现商业化



### Internet的特点

- 多个网络的集合
- **开放性：**以**TCP/IP **协议为核心和基础，不属于任何国家、组织或个人

- **用户不需要了解网络底层结构**
- 可以通过多种方式上网：PSTN拨号，ADSL，LAN用户、光纤
- 具有丰富的、多样的网络资源
- 多样的网络文化

### 因特网的组成

- 边缘部分：由所有连接在因特网上的`主机`组成。这部分**是用户直接使用的**，用来进行`通信`和`资源共享`
- 核心部分：由**大量网络**和连接这些网络的`路由器`组成。这部分是**为边缘部分提供服务**的。(提供连通性和交换)

## 1.2 三种交换方式

### **电路交换(Circuit Switching)**

电话交换机接通电话线的方式称为电路交换

从资源分配的角度来看，`交换`(Switching)就是按照某种方式是动态地分配传输线路的资源

电路交换的三个步骤：

1. 建立连接(分配通信资源)
2. 通话(一直占用通信资源)
3. 释放连接(归还通信资源)

**当使用电路交换来传送计算机数据时，其线路的传输效率往往很低**

原因：计算机数据是突发式地出现在传输线路上的

### 分组交换(Packet Switching)

发送方：构造分组、发送分组

路由器：缓冲分组、转发分组

接收方：接收分组、还原报文



### 电路交换、报文交换、分组交换的对比

**电路交换**

优点：

- 通信延时小
- 有序传输
- 没有冲突
- 适用范围广
- 实时性强
- 控制简单

缺点：

- 建立连接时间长
- 线路独占
- 使用效率低
- 灵活性差
- 难以规格化

**报文交换**

优点：

- 无需建立连接
- 动态分配线路
- 提高线路可靠性
- 提高线路利用率
- 提供多目标服务

缺点：

- 引起了转发时延
- 需要较大存储缓存空间
- 需要传输额外的信息量

**分组交换**

优点：

- 无需建立连接
- 线路利用率高
- 简化了存储管理
- 加速传输
- 减少了出错概率和重发数据量

缺点：

- 引发了转发时延
- 需要传输额外的信息量
- 对于数据服务，存在失序，丢失或重复分组的问题

- 对于虚电路服务，存在呼叫建立，数据传送和虚电路释放三个过程

## 1.3计算机网络的定义与分类

### 计算机网络的定义

**计算机网络的精确定义并未统一**

最简单定义：一些**互相连接**的、**自治**的计算机的**集合**

- 互联 是指计算机之间可以通过有线或无线的方式进行数据通信
- 自治 是指独立的计算机，它有自己的硬件和软件，可以单独运行使用
- 集合 是指至少两台计算机

**上课讲的：**

A computer network is a **collection** of **autonomous** computers **interconnected** by a single technology。

`计算机网络` 是 `自主`(自治)的计算机通过通信技术 (通信线路和通信设备) 互连起来的集合体

autonomous 自主的：计算机网络上的每一台计算机都有自己独立的硬件和操作系统

interconnected 互连的：计算机网络上的每一台计算机通过通信模块和接口相互连接

collection :计算机网络是多台计算机交换数据的协调系统

**另一种定义：**

计算机网络是将处于不同地理位置、独立存在的计算机通过通信设备和线路连接起来，利用功能完善的网络软件(协议、信息交换方式及网络操作系统等) 实现**资源共享**和**数据传送**的系统

**三网合一(三网融合):** 电信网络、有线电视网络、互联网



**较好的定义：**

计算机网络是由一些 **通用的、可编程的硬件互连** 而成的，而这些硬件并非专门用来实现某一特定目的。这些可编程硬件能够用来 **传送多种不同类型的数据**，并能 **支持广泛的和日益增长的应用**

- 计算机网络所连接的硬件，并不限于一般的计算机，而是包括了智能手机等智能硬件
- 计算机网络并非专门用来传送数据，而是能够支持很多种的应用(包括未来可能出现的各种应用)

### 计算机网络的分类

**按交换技术分类**

- 电路交换网络
- 报文交换网络
- 分组交换网络

**按使用者分类**

- 公用网
- 专用网

**按传输介质分类**

- 有线网络
- 无线网络

**按覆盖范围分类**

- 广域网WAN 

覆盖范围：几十公里到几千公里，一个国家、地区甚至横跨几个洲

任务：因特网的核心部分、为核心路由器提供远距离高速连接，互连分布在不同区域的城域网和局域网

- 城域网MAN 

覆盖范围：五到五十公里，几个街区甚至整个城市

任务：城市主干网，互连大量企业、机构和校园局域网

- 局域网LAN

覆盖范围：1公里左右，一个实验室，一栋楼或一个校园内

用微信计算机或工作站通过告诉通信线路相连，速录通常在10Mbitps以上，通常由某个单位单独拥有，使用和维护

- 个域网PAN

在个人工作的地方把属于个人使用的电子设备，如，便携式计算机、打印机、鼠标、键盘、耳机等，使用无线技术连接起来的网络。因此也称为无线个人区域网WPAN，覆盖范围大约为10m



**按拓扑结构分类**

- 总线型网络

使用单根传输线将计算机连接起来

优点：建网容易、增减结点方便、节省线路

缺点：重负载时通信效率不高，总线任意一处出现故障，则全网瘫痪

- 星型网络

将每个计算机都以单独的线路与中央设备相连

中央设备：早期是计算机，后来是集线器，现在一般为交换机或路由器

优点：便于网络的集中控制和管理（端用户之间的通信必须经过中央设备）

缺点：成本高，中央设备对故障敏感

- 环形网络

将所有计算机的网络接口连接成一个环。如：令牌环局域网

环可以是单环，也可以是双环，环中信号是单向传输的

- 网状型网络

每个结点至少有两条路径与其他结点相连，多用于广域网中

优点：可靠性高

缺点：控制复杂，线路成本高



以上四种基本的网络拖布还可以互联为更复杂的网络拓扑结构



## 1.4 计算机网络的性能指标

**性能指标可以从不同的方面来度量计算机网络的性能**

常用的计算机网络的性能指标有以下8个：

- 速率

- 带宽
- 吞吐量
- 时延
- 时延带宽积
- 往返时间
- 利用率
- 丢包率

### 速率

**比特(bit)**

计算机中**数据量的单位**，也是信息论中信息量的单位，一个比特就是二进制数字中的一个1或0

常用数据量单位

8bit = 1 Byte

KB=$2^{10}$B

MB=$2^{20}$B

GB=$2^{30}$B

TB =$2^{40}$B



连接在计算机网络上的主机在数字信道上传送比特的速率，也称为**比特率**或**数据率**

**常用数据单位**

**比特每秒** bit/s bps b/s

kb/s =$10^3$ bps

Mb/s =$10^6$ bps

Gb/s=$10^9$ bps

Tb/s=$10^{12}$ bps



### 带宽

带宽在模拟信号系统中的意义

**信号**所包含的各种不同频率成分所占据的**频率范围**

**单位：** Hz (kHz,MHz,GHz)



**带宽在计算机网络中的意义**

用来表示网络的通信线路所能传送数据的能力，因此网络带框表示在单位时间内从网络中的某一点到另一点送能通过的"**最高数据率**"

**单位：** b/s(kb/s,Mb/s,Gb/s,Tb/s)



### 吞吐量

单位时间内通过每个网络(或信道、接口)的数据量

**意义：** 对现实世界中的网络的一种测量，以便知道实际上到底有多少数据量能通过网络

吞吐量 **受网络带宽或额定速率的限制**



### 时延

网络时延由三部分组成：

- 发送时延

$$
\frac{分组长度(b)}{发送速率(b/s)}
$$

在构建网络时，应该做到各设备以及传输介质的速率匹配。这样才能完全发挥出本应具有的传输性能

- 传播时延

$$
\frac{信道长度(m)}{电磁波传播速率(m/s)}
$$

电磁波在自由空间的传播速率为 3x$10^8$m/s

铜线	2.3x$10^8$m/s

光纤	2.0x$10^8$m/s

- 处理时延

网络中的数据流量是动态变化的，一般不方便计算

- 排队时延(与处理时延合并)



### 时延带宽积

**传播时延和带宽的乘积**

链路的时延带宽积又称为**以比特为单位的链路长度**

若发送端连续发送数据，则在所发送的第一个比特即将达到终点时，发送端就已经发送了时延带宽积个比特



### 往返时间 RTT(Round-Trip Time)

在许多情况下，因特网上的信息不仅仅单方向传输，而是双向交互

我们有时很需要知道双向交互一次所需的时间即RTT



### 利用率

**信道利用率**

用来表示某信道有百分之几是被利用的

**网络利用率**

全网络的信道利用率的加权平均

当某信道利用率增大时，该信道引起的时延也会迅速增加，因此，**信道利用率并非越高越好**

令D0表示网络空闲时的时延，D来表示网络当前的时延，那么在适当的假定条件下，可以用下面的简单公式来表示D、D0和利用率U之间的关系
$$
D=\frac {D_0}{I-U}
$$
信道利用率达到50%，时延加倍

超过50%，时延急剧增大

接近100%，时延趋近于无穷大

一些拥有较大主干网的ISP通常会控制它们的信道利用率不超过50%

也不能使信道利用率太低，应该使用一些机制，可以根据情况动态调整输入到网络中的通信量，使网络利用率保持在一个合理的范围内



### 丢包率

即分组的丢失率，是指在一定的时间范围内，传输过程中 **丢失的分组数量与总分组数量的比率**

丢包率具体可分为接口丢包率、结点丢包率、链路丢包率、网络丢包率等

丢包率使网络运维人员非常关心的一个网络性能指标，但对普通用户来收往往并不关心这个指标，因为他们通常意识不到网络丢包

分组丢失的两种情况:

- 分组在传输过程中出现 **误码** 被结点丢弃
- 分组到达一台队列已满的分组交换机时被丢弃；在通信量较大时就可能造成**网络阻塞**

网络丢包率过高时，通常无法使网络应用正常工作



## 1.5 计算机网络体系结构

### 常见的计算机网络体系结构

**OSI体系结构**

七层协议的体系结构

自顶向下分别是:

- 应用层
- 表示层
- 会话层
- 运输层
- 网络层
- 数据链路层
- 物理层

**法律**上的国际标准



**TCP/TP体系结构**

- 应用层  HTTP SMTP DNS RTP..
- 运输层  TCP UDP...->向应用层的相关协议提供可靠的运输服务
- 网际层  IP协议->向下将不同的网络接口进行互连，向上为TCP协议和UDP协议提供网络互连服务
- 网络结构层 可以连接多种网络接口

**事实**上的国际标准



IP协议：

- IP over everything IP协议互连不同的网络接口
- Everything over IP IP协议可以为各种网络应用提供服务



**原理体系结构**

- 应用层
- 运输层
- 网络层
- 数据链路层
- 物理层



### 计算机网络体系结构分层的重要性

计算机网络是个非常复杂的系统

**分层**可将庞大而复杂的问题，转化为若干较小的局部问题，而这些较小的局部问题就比较容易研究和处理



**物理层**

采用怎样的传输媒体

采用怎样的物理接口

使用怎样的信号表示比特0和1



**数据链路层**

如何标识网络中的各主机(主机编制问题，例如MAC地址)

如何从信号所表示的一连串比特流中区分出地址和数据

如何协调各主机争用总线



**网络层**

如何标识各网络记忆网络中的主机(网络和主机共同编址的问题，例如IP地址)

路由器如何转发分组，如何进行路由选择



**运输层**

如何解决进程之间基于网络的通信问题

出现传输错误时，如何处理



**应用层**

通过应用进程间的交互来完成特定的网络程序



### 计算机网络体系结构专用术语

**实体**

任何可发送或接收信息的硬件或软件进程

**对等实体**

收发双方相同层次中的实体

**协议**

控制两个对等实体进行逻辑通信的规则的集合

**协议三要素**

- **语法** 定义所交换信息的格式
- **语义** 定义收发双发所要完成的操作
- **同步** 定义收发双方的时序关系

**服务**

在协议的控制下，两个对等实体之间的逻辑通信使得本层能够向上一层提供服务

要实现本层协议，还需要使用下面一层所提供的服务



协议是"**水平的**"，服务是"**垂直的**"

实体看得见相邻下层所提供的服务，但并不知道实现该服务的具体协议。下面的协议对上面的实体是"透明"的



**服务访问点**

在统一系统中相邻两层的实体交换信息的逻辑接口，用于区分不同的服务类型

- 数据链路层的服务访问点为帧的"类型"字段
- 网络层的服务访问点为IP数据报首部中的"协议字段"
- 运输层的服务访问点为"端口号"

**服务原语**

上层使用下层所提供的服务必须通过与下层交换一些命令，这些命令称为服务原语



**协议数据单元PDU**

**对等层次之间传送的数据包**称为该层的协议数据单元



**服务数据单元SDU**

同一系统内，**层与层之间交换的数据包**称为服务



# 物理层

## 2.1 物理层的基本概念

**传输媒体分类**

传输媒体分为两大类:

- 导引型传输媒体

双绞线、同轴电缆、光纤

- 非导引型传输媒体

微波通信(2~40GHz)



**物理层协议的主要任务**

1. 机械特性：指明接口所用接线器的**形状**和**尺寸**、**引脚数目**和**排列**、**固定**和**锁定**装置
2. 电气特性：指明在接口电缆的各条线上出现的**电压的范围**
3. 功能特性：指明某条显示昂出现的**某一电平的电压表示何种意义**
4. 过程特性：指明对于不同功能的各种可能**事件的出现顺序**



物理层考虑的是怎样才能在连接各种计算机的传输媒介上传输数据比特流。



**物理层为数据链路层提供服务**

物理层为数据链路层屏蔽了各种传输媒体的差异，使数据链路层只需要考虑如何完成本层的协议和服务，而不必考虑网络具体的传输媒介是什么。



## 2.2 物理层下面的传输媒体(了解)

**导引型传输媒体** 电磁波被导引沿着固体媒体传播

- **同轴电缆**

基带同轴电缆(50Ω)：数字传输，过去用于局域网

宽带同轴电缆(75Ω)：模拟传输，目前用于有线电视

同轴电缆价格较贵，布线不够灵活和方便，随着集线器的出现，在局域网领域基本上都是采用双绞线作为传输媒体

- **双绞线**

无屏蔽双绞线UTP电缆、屏蔽双绞线STP电缆

绞合的作用：抵御部分来自外界的电磁波干扰，减少相邻导线的电磁干扰

一般家庭使用超五类电缆即可满足需求

- **光纤**

**优点：**

通信容量大

传输损耗小，远距离传输时更加经济

抗雷电和电磁干扰性能好，在大电流脉冲抗干扰的环境下尤为重要

无串音干扰，保密性好，不易被窃听

体积小，重量轻

**缺点：**

割接光纤需要专用设备

光电接口价格较贵



**光在光纤中传输的基本原理**

纤芯是高折射率的，包层是低折射率的

当光从高折射率的媒体射向低折射率的媒体时，其折射角将大于入射角

因此，如果入射角足够大，就会出现全反射，即光碰到包层时，就会反射回纤芯，该过程反复进行，光就沿着纤芯不断传输下去



**多模光纤：**存在许多条不同角度入射的光线在一条光纤中传输

由于光的色散，光在多模光纤中传输一定距离后必然产生信号失真(脉冲展宽)，多模光纤只适合**近距离传输**

发送光源：发光二极管 接受检测：光电二极管



**单模光纤:**光纤一直向前传播而不发生全反射

没有模式色散，适合长距离传输，衰减小，但其制造成本高，对光源要求高

发送光源：激光发生器

接收检测：激光检波器



- **电力线**

**非导引型传输媒体**  利用电磁波在自由空间的传播来传送数据信息

根据调制波的振幅、频率或相位来传输信息

**无线电波**

**微波**

**红外线**

点对点无线传输，直线传输，中间不能有障碍物，传输距离短，传输速率低

**可见光**



## 2.3 **传输方式**

**串行传输与并行传输**

串行传输：数据是一个比特一个比特依次发送的，发送端到接收端之间只需要一条数据传输线路

并行传输：一次性发送n个比特而非一个比特，发送端和接收端之间需要n条数据传输线路

优点：速度为串行传输的n倍

缺点：成本高



计算机内部常采用并行传输方式，计算机网络中常使用串行传输方式



**同步传输和异步传输**

**同步传输**：数据块以稳定的比特流的形式传输，字节之间没有间隔，接收端在每个比特信号的中间时刻进行检测，以判别接收到的是比特0还是比特1

由于不同设备的时钟频率存在一定差异，不能完全相同，在传输大量数据的过程中，产生的判别时刻的累计误差，回导致接收端对比特信号的判别错位。因此，需要采用方法使手法双方的时钟保持同步：

- 外同步：在收发双方之间添加一条单独的时钟信号线，发送端在发送数据信号的同时，另外发送一路时钟同步信号，接收端按照时钟同步信号的节奏来接收数据
- 内同步：发送端将时钟同步信号编码到发送数据中一起传输(传统以太网->曼切斯特编码)



**异步传输**：以字节作为独立的传输单位，字节之间的时间间隔不是固定的。

接收端仅在每个字节的起始处对字节内的比特实现同步，每个字节前后分别加上起始位和结束位

异步：字节之间异步，字节之间的时间间隔不固定，但字节中的每个比特仍然要同步(各比特的持续时间是相同的)



**单工通信、半双工通信、全双工通信**

单向通信(单工)：通信双方只有一个数据传输方向 无线电广播 

双向交替通信(半双工)：通信双方可以相互传输数据，但不能同时进行

双向同时通信(全双工)：通信双方可以同时发送和接收信息  电话

单向通信只需要一条信道

而双向交替通信和双向同时通信需要两条信道



## 2.4 编码与调制

`消息`(message)：文字、图片、音频、视频...

`数据`(data)：运送消息的实体

`信号`(signal)：信号是数据的电磁表现

`基带信号`：信源发出的原始电信号

- 数字基带信号 
- 模拟基带信号

信号需要在信道中传输，信道又可分为数字信道和模拟信道



对于数字基带信号的处理

`编码`：在不改变信号性质的前提下，仅对数字基带信号的波形进行变化

编码产生的信号仍为数字信号，可以在数字信道中传输

`调制`：把数字基带信号的频率范围，搬移到较高的频段，并转换为模拟信号

调制后产生的信号是模拟信号，可以在模拟信道中传输



对于模拟基带信号的处理也有编码和调制两种

对音频信号进行编码的脉码调制PCM

采样，量化，编码三个步骤进行数字化



将语言数据加载到模拟的载波信号中传输



频分复用FDM技术，充分利用带宽资源



**码元**

在使用时间域的波形表示数字信号时，**代表不同离散数值的基本波形**



**常用编码**

**不归零编码**：正电平表示比特1，负电平表示比特0，在整个码元时间内，电平不会出现零电平

需要额外一根传输线来传输时钟信号使发送方和接收方同步。

存在同步问题，计算机网络中的数据传输不采用这种编码



**归零编码：** 每个码元传输结束后信号都要"归零"，接收方只要在信号归零后进行采样即可，不需要单独的时钟信号

实际上相当于把时钟信号以"归零"方式编码在了数据之内，这称为**自同步**信号

归零编码中，大部分的数据带宽都用来传输"归零"而浪费掉了

自同步，但编码效率低



**曼彻斯特编码**

在每个码元时间的中间时刻，信号都会发生跳变。负跳变表示比特1，正跳变表示比特0.

码元中间时刻的跳变既表示时钟，又表示数据 



**差分曼彻斯特编码**

每个码元的中间时刻，信号都会发生条边，跳变仅表示时钟，用码元开始处电平是否发生变化来表示数据





**基本调制方法**

调幅(AM)

调频(FM)

调相(PM)

基本调制方法一个码元只能包含一比特信息



**混合调制**

频率和相位是相关的，一次只能调制频率和相位中两个中的一个

通常，相位和振幅可以结合起来一起调制，称为 **正交振幅调制QAM**

12种相位，每种相位有1或2种振幅可选

16QAM调制出16种码元，每种码元可以表示四个比特

码元与4各比特的对应关系采用格雷码，任意两个相邻码元只有1个比特不同



## 2.5 信道的极限容量

码间串扰：信号波形失去了马元之间的清晰界限。

产生失真的原因:

- 码元传输速率
- 信号传输距离
- 噪声干扰
- 传输媒体质量



奈氏准则(奈奎斯特)：在假定的理想条件下，**为了避免码间串扰**，**码元传输速率是有上限的**

理想低通信道的最高码元传输速率=2W Baud

理想带通信道的最高码元传输速率= W Baud

W：信道带宽 (Hz)

Baud：波特，码元/秒

码元传输速率又称为波特率，调制速率，波形速率或符号速率。与比特率有一定关系:

当一个码元只携带1比特的信息量时，则波特率与比特率在数值上时相等的

当一个码元携带n比特信息量时，则波特率转换为比特率时，数值要乘以n

要提高信息传输速率(比特率)，就必须设法使每一个码元能携带更多个比特的信息量，着需要采用多元制

实际的信道所能传输的最高码元速率，要明显低于奈氏准则给出的这个上限数值



**信道的极限信息传输速率还要受限于实际的信号在信道中传输时的信噪比**



**香农公式**

带宽受限且有高斯白噪声干扰的信道的极限传输速率
$$
c=W\times log_2^{(1+\frac{S}{N})}
$$
c：信道的极限信息传输速率(b/s)

W：信道带宽 (Hz)

s：信号内所传信号的平均功率

N：信道内的高斯噪声功率

S/N：信噪比，使用分贝(dB)作为度量单位

信噪比(dB)=$10\times log_{10}{\frac{S}{N}}$



信道带宽或信道中信噪比越大，信息的极限传输速率越高

在实际信道上能够达到的信息传输速率要比该公式的极限传输速率要低不少，这是因为在实际信道中，信号还要受到其他一些损伤，如各种脉冲干扰，信号在传输中的衰减和失真等等



在信道带宽一定的情况下，根据奈氏准则和香农公式，想要提高信息的传输速率就必须采用**多元制**(更好的调制方法)和**努力提高信道中的信噪比**



# 数据链路层

## 3.1 数据链路层概述

`链路`(Link)就是从一个结点到相邻结点的一段物理线路，而中间没有任何其他的交换结点

`数据链路`(Data Link) 是指把实现通信协议的硬件和软件加到链路上，就构成了数据链路

数据链路层以`帧`为单位传输和处理数据



**数据链路层的三个重要问题**

1. 封装成帧

数据链路层给网络层协议数据单元添加一个数据链路层协议首部(帧头)，还要添加一个帧尾，这个操作叫做封装成帧。

目的:在链路上以帧为单元传输数据

2. 差错检测



3. 可靠传输

接收方主机接收到有误码的帧后，不会接收该帧，将其丢弃

可靠传输：发送方发送什么，接收方就接收到什么



**使用广播信道的数据链路层**

 编制问题



**数据链路层的互联设备**

网桥和交换机的工作原理

集线器(物理层互连设备)与交换机的区别



## 3.2 封装成帧

数据链路层给上层交付的协议数据单元添加帧头和帧尾使之称为帧

- 帧头和帧尾中包含有很重要的控制信息

- 帧头和帧尾的作用之一就是**帧定界**



例如：

PPP帧的帧头和帧尾中，分别包含1个字节长的标志字段

以太网V2的MAC帧的帧头和帧尾中无帧定界标志，而是直接将封装好的MAC帧传输给物理层，物理层在MAC帧前面添加8字节的前导码，前七位是前同步码，使接收方的时钟同步，之后的一字节为帧开始定界符。以太网规定帧间间隔为96比特的发送时间，所以MAC不需要帧结束定界符

透明传输是指 **数据链路层对上层交付的传输数据没有任何限时**，就好像数据链路层不存在一样



面向字节的物理链路使用**字节填充(或称字符填充)的方法**实现透明传输

**添加转义字符**



面向比特的物理链路使用**比特填充的方法**实现透明传输

帧的首部和尾部都为01111110，帧的数据部分每五个1后面就添加一个0



为了提高帧的传输效率，应当**帧的数据部分的长度尽可能大些**

 考虑到差错控制等多种因素，每一种数据链路层协议都规定了帧的数据部分的长度上限，即**最大传送单元**MTU(Maximum Transfer Unit)



## 3.3 差错检测

实际的通信链路都是不理想的，比特在传输过程中可能会产生差错：

1可能变为0，0可能变为1，着称为**比特差错**

`误码率`BER(Bit Error Rate)：一段时间内，传输错误的比特占所传输比特总数的比率

使用差错检测吗可以来检测数据传输过程中是否产生了比特差错，使数据据链路层需要解决的重要问题之一



**奇偶校验**

在待发送的数据后面 添加1位奇偶校验位，使整个数据(包括所添加的校验位在内)中"1"的个数为奇数(奇校验)或偶数(偶校验)

如果有奇数个位发生误码，则奇偶性发生变化，可以检查除误码，否则无法检查出误码。



**循环冗余检验CRC**(Cyclic Redundancy Check)

接收方约定好一个生成多项式G(x)

发送方基于待发送的数据和生成多项式计算出差错检测码(冗余码)

接收方通过生成多项式来计算收到的数据是否产生误码



注意:

- 在被除数后添加生成多项式最高次个0
- 余数就是冗余码，长度和生成多项式最高次数相同



**检错码**只能检测出帧在传输过程中出现了差错，但不能定位错误，因此**无法纠正错误**

可以使用更多冗余信息的**纠错码**进行**前向纠错**,但纠错码的开销比较大，在**计算机网络中较少使用**



CRC有很好的检错能力(漏检率非常低)，易于用硬件实现，广泛应用于数据链路层



在计算机网络中通常采用检错重传方式来纠正纠错传输中的差错，或者仅仅使丢弃检测到差错的帧，这取决于数据链路层向上层提供的是可靠传输服务还是不可靠传输服务



## 3.4.1 可靠传输的基本概念

使用差错检测技术，接收方的数据链路层就可检测出帧在传输过程中是否产出**误码**(比特错误)



数据链路层给上层提供的服务类型:

- `不可靠传输服务`：**仅仅丢弃有误码的帧**,其他什么也不做

- `可靠传输服务`:想办法实现**发送端发送什么，接收端就收到什么**



一般情况下，**有限链路**的误码率比较低，为了减小开销，并不要求**数据链路层**向上提供可靠传输服务。即使出现了误码，可靠传输问题也由其上层处理

**无线链路**易受干扰，误码率较高，因此要求数据链路层必须为上层提供可靠服务



**比特差错**只是传输差错中的一种

从整个计算机网络体系结构来看，传输差错还包括**分组丢失**、**分组失序**以及**分组重复**

这些传输差错一般不会出现在数据链路层，而会出现在其上层



**可靠传输服务并不仅局限于数据链路层**，其他各层可选择实现可靠传输

 

### 3.4.2 可靠传输的实现机制--停止-等待协议

三种可靠传输的实现机制：

- 停止-等待协议SW
- 回退N帧协议GBN
- 选择重传协议SR

这三种可靠传输实现机制的基本原理并不仅限于数据数据链路层，可以应用到计算机网络体系结构的各层协议中



#### 停止-等待协议 SW

![](image/%E5%81%9C%E6%AD%A2-%E7%AD%89%E5%BE%85%E5%8D%8F%E8%AE%AE.png)

发送方和接收方通过互联网进行通信，纵坐标为时间

DATA：数据分组

ACK：确认分组，接收方接收到发送方发送的数据分组后，进行差错检测，若没有误码，则接受该数据分组并且给发送方发送一个确认分组，发送方接收到确认分组后，才可以发送下一个数据分组

NAK：否认分组，若接收方接收到发送方发送的数据分组后，进行差错检验，发现有误码，则丢弃该数据分组，并给发送方发送一个否认分组。发送方接收到否认分组后，会重新发送数据分组，直到接收到确认分组后，才能发送下一个数据分组

![](image/%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0.png)

​	接收方如果收不到数据分组，就不会发送ACK或NAK。如果不采取其他措施，发送方就会一直处于等待接收方ACK或NAK的状态

​	为解决该问题，可以在发送方发送完一个数据分组时，启动一个`超时计时器`。若到了超时计时器所设置的`重传时间`而发送方仍收不到接收方的任何ACK或NAK，则重传原来的数据分组，这就叫做`超时重传`

一般将重传时间选为略大于"从发送方到接收方的平均往返时间"

![](image/%E5%88%86%E7%BB%84%E9%87%8D%E5%A4%8D.png)

确认丢失

为了**避免分组重复**这种传输错误，必须给**每个分组带上序号**

对于停止-等待协议，由于每发送一个数据分组就停止等待，只要保证每发送一个新的数据分组，其发送序号与上次发送的数据分组的序号不同就可以了，因此**只需要用一个比特来编号即可**

发送方接收到重复的数据分组后，会丢弃该数据分组，并给发送方发送确认分组，防止发送方继续发送重复的数据分组

![](image/%E7%A1%AE%E8%AE%A4%E8%BF%9F%E5%88%B0.png)

对确认分组也进行编号，可以使发送方避免将确认分组进行误判

在数据链路层的点对点信道，往返时间比较固定，不会出现确认迟到的情况，所以在数据链路层实现停止-等待协议可以不给确认分组编号



**注意事项:**

- 接收方检测到数据分组有误码时，可以将其丢弃等待超时重传，但对于误码率较高的点对点链路，为使发送方尽早重传，可以给发送方发送NAK否认分组

- 为了让接收方能够判断所收到的数据分组是否使重复的，需要给**数据分组编号**。在停止-等待协议中，只需要1个比特编号即可
- 为了让发送方能判断收到的ACK分组是否是重复的，需要给**ACK分组编号**。数据链路层一般不会出现ACK分组迟到的情况，因此在数据链路层实现停止-等待协议可以不给ACK分组编号
- 超时计时器的**重传时间**一般略大于"从发送方到接收方的平均往返时间"
  - 在数据链路层的往返时间比较确定，重传时间好设定
  - 然而在传输层，由于端到端的时间非常不确定，设置合适的重传时间有时并不容易



停止等待协议的信道利用率

![](image/%E5%81%9C%E6%AD%A2-%E7%AD%89%E5%BE%85%E5%8D%8F%E8%AE%AE%E4%BF%A1%E9%81%93%E5%88%A9%E7%94%A8%E7%8E%87.png)

TD: 发送时延

RTT: 收发双发之间的往返时间RTT

TA：接收方发送确认分组的发送时延

信道利用率U
$$
U=\frac{T_D}{T_D+RTT+T_A}
$$
当往返时延RTT远大于数据帧发送时延TD时，信道利用率非常低



自动请求重传ARQ
